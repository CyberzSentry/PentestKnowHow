## Android Studio Emulator

### Requirements
-  jdk 11 ([Bypass oracle login](general/notes#Bypass-required-login))
- 
### Install

1. Download command-line-tools from  https://developer.android.com/studio/#downloads
2. Create local appdata directory
	1. `cd $env:LOCALAPPDATA`
	2. `mkdir Android`
	3. `cd Android`
3. Extract tools
	1. `tar -xf C:\Users\<user>\Downloads\commandlinetools-win-<version>.zip`
	2. `cd cmdline-tools`
	3. `mkdir latest`
	4. `mv .\* .\latest`
4. Set env variables and add to Path
	1. `setx ANDROID_SDK_ROOT $env:LOCALAPPDATA\Android`
	2. `setx path "$env:PATH;$env:LOCALAPPDATA\Android\cmdline-tools\latest\bin"`
5. Refresh powershell and check installation
	1. `sdkmanager.bat --list`
6. Install emulator
	1. `sdkmanager.bat "platform-tools"`
	2. `sdkmanager "emulator"`
7. Add emulator and adb to path
	1.  `setx path "$env:PATH;$env:LOCALAPPDATA\Android\emulator"`
	2.  `setx path "$env:PATH;$env:LOCALAPPDATA\Android\platform-tools"`
8. Install HAXM
	1. Disable HyperV
	2. `sdkmanager.bat "extras;intel;Hardware_Accelerated_Execution_Manager"`
	3. `cd $env:ANDROID_SDK_ROOT\extras\intel\Hardware_Accelerated_Execution_Manager`
	4. `.\haxm-<version>-setup.exe`
9. Install device image and android
	1. `sdkmanager.bat "system-images;android-31;default;x86_64" "platforms;android-31"`

Sources:
- https://dev.to/andreisfedotov/how-to-install-android-emulator-without-installing-android-studio-3lce

## Setup device

```
avdmanager create avd -n exploit_device -k "system-images;android-31;default;x86_64" -d resizable  
```

### Setup proxy

In the settings of a running emulator.

![[proxy_emulator.png]]

And install CA in "Settings>Network&Internet>Internet>Network Preferences>Install certificates" on the running device. The CA file can be dragged and dropped to the emulator.

Sources:
- https://dev.to/andreisfedotov/how-to-install-android-emulator-without-installing-android-studio-3lce

### Keyboard support

To add keyboard support edit file `<homedir>\.android\avd\<devicename>.avd\hardware-qemu.ini`.

Change following line:
```
hw.keyboard = true
```

Restart the device.

### Start emulator

`emulator -avd <avd_name>`

### Install application

To install .apk application just drag and drop it to running emulator.

### Usefull cmds

List all AVDs: `avdmanager list avd`
Instal system image `sdkmanager.bat "system-images;android-31;default;x86_64"`

### FAQ
#### Missing system image
##### Error:
```
INFO    | Android emulator version 32.1.11.0 (build_id 9536276) (CL:N/A)
INFO    | AVD Nexus_4_x64_root has path C:\Users\maksy\.android\avd\Nexus_4_x64_root.avd
INFO    | trying to check whether C:\Users\maksy\AppData\Local\Android is a valid sdk root
WARNING | C:\Users\maksy\AppData\Local\Android\system-images\android-31\default\x86_64\ is not a valid directory.
WARNING | emulator has searched the above paths but found no valid sdk root directory.
PANIC: Broken AVD system path. Check your ANDROID_SDK_ROOT value [C:\Users\maksy\AppData\Local\Android]!
```

##### Solution:
Install missing system image eg:
`sdkmanager.bat "system-images;android-31;default;x86_64"`