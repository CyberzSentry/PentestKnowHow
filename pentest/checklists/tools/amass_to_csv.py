#!/bin/python
import argparse
import os




def parse(args):
    with open(args.input, "r") as inf:
        with open(args.output, "w") as outf:
            for line in inf:
                splits = line.rsplit(" ", 2)
                for ip in splits[-1].split(","):
                    line = ",".join([splits[0].strip(), splits[1], ip.strip()+"\n"])
                    if args.verbose:
                        print(line, end="")
                    outf.write(line)

    print(f"CSV wrote to {args.output}")


if __name__ == "__main__":

    parser = argparse.ArgumentParser(
        prog="Amass-to-csv",
        description="This program transforms amass output file to a CSV format.",
        epilog="Developed by m0rt - https://github.com/maxDoesHacking/PentestKnowHow"
    )
    parser.add_argument("input", help="Amass data file")
    parser.add_argument("-o", "--output", required=False, help="Amass output csv file")
    parser.add_argument("-v", "--verbose", action='store_false', default=False, help="Verbose")

    args = parser.parse_args()

    if args.output == None:
        output: str = os.path.basename(args.input) + ".csv"
        args.output = os.path.join(os.path.dirname(args.input), output)

    parse(args)
